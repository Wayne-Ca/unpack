PROCEDURE createUDB (* Version 01.00.00 *) (* Declarations *) (* Variable Record *) (* Array *) TYPE VREC=vTyp,nTyp:BYTE; nVar:BOOLEAN; vOff,vdOff,dsOff,dmOff,fOff,pOff:INTEGER DIM varRec(400):VREC (* File Record *) TYPE VFP1=vdTkn:BYTE; vdPtr,vdSiz,dsPtr,dsvSiz,dsSiz,dmSiz,fSiz,pSiz,elem1,elem2,elem3,vSRLen:INTEGER TYPE VFP2=vArray:STRING[19]; vName:STRING[29]; vStrLen:STRING[7]; vRecNum,vRefCnt,intReal,pVar:INTEGER TYPE VFP3=mTyp,vLnk,fNum:BYTE; pRec,pFld:BOOLEAN TYPE VFRC= vp1:VFP1; vp2:VFP2; vp3:VFP3 DIM varFRec:VFRC (* Line Reference Record *) (* Array *) (* TYPE LNREF=hLTyp:BYTE; hLOff:INTEGER (* DIM linRef,linRefs(300):LNREF (* File Record *) TYPE LNREC=lnRecNum,lnRefCnt:INTEGER; lnTyp:BYTE; lnOff:INTEGER; lnNum:STRING[5] DIM linRec:LNREC (* DIM linRec,linRecs(2):LNREC (* DSMap - DSAT Map *) TYPE DSMP=dsOf,dsDm,dsMSz,dsSz:INTEGER DIM DSMap(100):DSMP (* Path and Other Variables *) DIM outPath:BYTE DIM outOpen,hasRecords:BOOLEAN DIM loopCnt,varCount,linCount,er:INTEGER (* Variable Reference Counters *) DIM varRefs:INTEGER (* Line Reference Counters *) DIM lineRefs:INTEGER (* Version number, File names *) DIM tVers,version:STRING[8]; dataDir:STRING[16]; outFile:STRING[29]  BASE 0 (* Records *) FOR loopCnt:=0 TO 399   varRec(loopCnt).vTyp:=0 \varRec(loopCnt).nTyp:=0   varRec(loopCnt).nVar:=TRUE \varRec(loopCnt).vOff:=0   varRec(loopCnt).vdOff:=0 \varRec(loopCnt).dsOff:=0   varRec(loopCnt).dmOff:=0 \varRec(loopCnt).fOff:=0   varRec(loopCnt).pOff:=0 NEXT loopCnt varFRec.vp1.vdTkn:=0 \varFRec.vp1.vdPtr:=0 \varFRec.vp1.vdSiz:=0 varFRec.vp1.dsPtr:=0 \varFRec.vp1.dsvSiz:=0 \varFRec.vp1.dsSiz:=0 varFRec.vp1.dmSiz:=0 \varFRec.vp1.fSiz:=0 \varFRec.vp1.pSiz:=0 varFRec.vp1.elem1:=0 \varFRec.vp1.elem2:=0 \varFRec.vp1.elem3:=0 varFRec.vp1.vSRLen:=0 \varFRec.vp2.vArray:="" varFRec.vp2.vName:="" \varFRec.vp2.vStrLen:="" varFRec.vp2.vRecNum:=0 \varFRec.vp2.vRefCnt:=0 \varFRec.vp2.intReal:=0 varFRec.vp2.pVar:=0 \varFRec.vp3.mTyp:=0 \varFRec.vp3.vLnk:=0 \varFRec.vp3.fNum:=0 varFRec.vp3.pRec:=FALSE \varFRec.vp3.pFld:=FALSE linRec.lnRecNum:=0 \linRec.lnRefCnt:=0 \linRec.lnTyp:=0 linRec.lnOff:=0 \linRec.lnNum:="" (* DSMap *) FOR loopCnt:=0 TO 99   DSMap(loopCnt).dsOf:=0   DSMap(loopCnt).dsDm:=0   DSMap(loopCnt).dsMSz:=0   DSMap(loopCnt).dsSz:=0 NEXT loopCnt (* Version number *) version:="01.00.00" hasRecords:=FALSE (* Variable Reference Counters *) varRefs:=0 \varCount:=0 (* Line Reference Counters *) lineRefs:=0 \linCount:=0  ON ERROR GOTO 15 dataDir:="/DD/DATA/UNPACK/" OPEN #outPath,LEFT$(dataDir,LEN(dataDir)-1):READ+DIR CLOSE #outPath 5 outOpen:=FALSE varCount:=0 linCount:=0  PRINT "Deleting Old Files" GOSUB 10 \REM delete old files if they exist PRINT   outFile:=dataDir+"initDB" PRINT "Creating Program Data File: initDB";  CREATE #outPath,outFile:WRITE outOpen:=TRUE PUT #outPath,version PUT #outPath,varFRec PUT #outPath,DSMap CLOSE #outPath outOpen:=FALSE PRINT   outFile:=dataDir+"varDefs" PRINT "Creating Variable Reference File: varDefs";  CREATE #outPath,outFile:WRITE outOpen:=TRUE PUT #outPath,varCount FOR loopCnt:=1 TO 400 PUT #outPath,varFRec NEXT loopCnt CLOSE #outPath outOpen:=FALSE PRINT   outFile:=dataDir+"linDefs" PRINT "Creating Line Reference File: linDefs";  CREATE #outPath,outFile:WRITE outOpen:=TRUE PUT #outPath,linCount FOR loopCnt:=1 TO 300 PUT #outPath,linRec NEXT loopCnt CLOSE #outPath outOpen:=FALSE PRINT   outFile:=dataDir+"procData" PRINT "Creating Procedure Data File: procData";  CREATE #outPath,outFile:WRITE outOpen:=TRUE PUT #outPath,hasRecords (* Variables lookup table *) PUT #outPath,varRec (* Variable Reference Counts *) PUT #outPath,varRefs \ PUT #outPath,varCount (* Line Reference Counts *) PUT #outPath,lineRefs \ PUT #outPath,linCount CLOSE #outPath outOpen:=FALSE PRINT   PRINT "Finished" END   10 ON ERROR GOTO 11 outFile:=dataDir+"initDB" OPEN #outPath,outFile:READ GET #outPath,tVers IF tVers<>version THEN   SEEK #outPath,0   (* New, so no changes yet *) ENDIF CLOSE #outPath PRINT "Deleting "; outFile DELETE outFile 11 ON ERROR GOTO 12 outFile:=dataDir+"varDefs" OPEN #outPath,outFile:WRITE CLOSE #outPath PRINT "Deleting "; outFile DELETE outFile 12 ON ERROR GOTO 13 outFile:=dataDir+"linDefs" OPEN #outPath,outFile:WRITE CLOSE #outPath PRINT "Deleting "; outFile DELETE outFile 13 ON ERROR GOTO 14 outFile:=dataDir+"procData" OPEN #outPath,outFile:WRITE CLOSE #outPath PRINT "Deleting "; outFile DELETE outFile 14 ON ERROR  RETURN  15 er:=ERR IF er=216 THEN    SHELL "makdir "+dataDir   GOTO 5 ELSE    PRINT "Error #"; er   END  ENDIF 